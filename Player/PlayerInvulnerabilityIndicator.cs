using System.Collections;
using UnityEngine;

public class PlayerInvulnerabilityIndicator : MonoBehaviour
{
    [SerializeField] float flashInterval = 0.2f;

    private Material defaultMaterial;
    private Material blackMaterial;
    private SpriteRenderer spriteRenderer;
    private bool usingBlackMaterial = false;
    private Coroutine flashCoroutine;

    private void Awake()
    {
        spriteRenderer = GetComponent<SpriteRenderer>();
        defaultMaterial = spriteRenderer.material;
        blackMaterial = Resources.Load<Material>(EditorConstants.RESOURCE_BLACK_FLASH);
    }

    public void StartFlash()
    {
        usingBlackMaterial = false;
        if (flashCoroutine == null)
            flashCoroutine = StartCoroutine(FlashCoroutine());
    }

    public void EndFlash()
    {
        if (flashCoroutine != null)
        {
            StopCoroutine(flashCoroutine);
            flashCoroutine = null;
            spriteRenderer.material = defaultMaterial;
        }
        usingBlackMaterial = false;
    }

    private IEnumerator FlashCoroutine()
    {
        while (true)
        {
            yield return new WaitForSecondsRealtime(flashInterval);
            spriteRenderer.material = usingBlackMaterial ? defaultMaterial : blackMaterial;
            usingBlackMaterial = !usingBlackMaterial;
        }
    }
}
